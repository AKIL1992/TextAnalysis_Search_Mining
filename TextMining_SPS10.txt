$$$$$$$$$$$$$$$$$
$$ TEXT MINING $$
$$$$$$$$$$$$$$$$$

CREATE SCHEMA SHA;

CREATE TABLE SHA.TEXTMINING_AWARDS
LIKE "TEXTMINING"."TEXTMINING_AWARDS"
WITH DATA;

DROP TABLE SHA.TEXTMINING_AWARDS;
CREATE COLUMN TABLE SHA.TEXTMINING_AWARDS 
(
"FEDERAL_AWARD_ID_NUMBER" NVARCHAR(10), 
"PDPI_NAME" NVARCHAR(500), 
"AWARD_DATE" DAYDATE CS_DAYDATE, 
"AWARD_YEAR" NVARCHAR(4), 
"AWARD_AMOUNT" INTEGER CS_INT, 
"AWARD_TITLE" NVARCHAR(5000), 
"AWARD_ABSTRACT" NCLOB MEMORY THRESHOLD 1000, 
"PROGRAM" NVARCHAR(500), 
"CONST" NVARCHAR(5), 
"COU" INTEGER CS_INT, 
"AWARDEE" NVARCHAR(500), 
"AWARDEE_STREET" NVARCHAR(500), 
"AWARDEE_CITY" NVARCHAR(500), 
"AWARDEE_COUNTY" NVARCHAR(500), 
"AWARDEE_STATE" NVARCHAR(500), 
"AWARDEE_COUNTRY" NVARCHAR(500), 
"AWARDEE_NAME" NVARCHAR(500), 
PRIMARY KEY ("FEDERAL_AWARD_ID_NUMBER")
);

-- import data from csv IF you don't have table

SELECT AWARD_TITLE, AWARD_ABSTRACT, PROGRAM
FROM SHA.TEXTMINING_AWARDS;

SELECT PROGRAM, COUNT(*) as COUNT
FROM SHA.TEXTMINING_AWARDS
GROUP BY PROGRAM
ORDER BY COUNT(*) DESC;

SELECT AWARD_TITLE, AWARD_ABSTRACT, PROGRAM
FROM SHA.TEXTMINING_AWARDS
WHERE FEDERAL_AWARD_ID_NUMBER = 1242501;

DROP FULLTEXT INDEX SHA.TEXTMINING_INDEX;
CREATE FULLTEXT INDEX TEXTMINING_INDEX
ON SHA.TEXTMINING_AWARDS (AWARD_ABSTRACT)
FAST PREPROCESS OFF
SEARCH ONLY OFF
TEXT ANALYSIS ON
TEXT MINING ON;

MERGE DELTA OF SHA.TEXTMINING_AWARDS;

SELECT T.FEDERAL_AWARD_ID_NUMBER, T.AWARD_TITLE, T.AWARD_ABSTRACT, T.TOTAL_TERM_COUNT, T.SCORE
FROM TM_GET_RELATED_DOCUMENTS (
DOCUMENT IN FULLTEXT INDEX WHERE FEDERAL_AWARD_ID_NUMBER = 1242501
SEARCH "AWARD_ABSTRACT" FROM SHA.TEXTMINING_AWARDS
RETURN
TOP 10
FEDERAL_AWARD_ID_NUMBER, AWARD_TITLE, AWARD_ABSTRACT
) AS T;

SELECT *
FROM TM_GET_RELATED_DOCUMENTS (
DOCUMENT IN FULLTEXT INDEX WHERE FEDERAL_AWARD_ID_NUMBER = 1242501
SEARCH "AWARD_ABSTRACT" FROM SHA.TEXTMINING_AWARDS
RETURN
PRINCIPAL COMPONENTS 2
CLUSTERING 'COMPLETE_LINKAGE'
CORRELATION
TOP 10 
FEDERAL_AWARD_ID_NUMBER, AWARD_TITLE, AWARD_ABSTRACT
) AS T
WHERE T.SCORE > 0.05;

SELECT RANK, TOTAL_TERM_COUNT, SCORE, AWARD_TITLE, AWARD_ABSTRACT, FEDERAL_AWARD_ID_NUMBER
FROM TM_GET_RELEVANT_DOCUMENTS (
TERM 'ocean'
SEARCH "AWARD_ABSTRACT" FROM SHA.TEXTMINING_AWARDS
RETURN
TOP 10 
FEDERAL_AWARD_ID_NUMBER, AWARD_TITLE, AWARD_ABSTRACT
) AS T;

SELECT T.TERM, T.NORMALIZED_TERM, T.TERM_TYPE, T.TERM_FREQUENCY,
T.DOCUMENT_FREQUENCY, T.SCORE
FROM TM_GET_RELATED_TERMS (
TERM 'ocean'
SEARCH "AWARD_ABSTRACT" FROM SHA.TEXTMINING_AWARDS
RETURN
TOP 10 ) AS T;

SELECT T.TERM, T.NORMALIZED_TERM, T.TERM_TYPE, T.TERM_FREQUENCY,
T.DOCUMENT_FREQUENCY, T.SCORE
FROM TM_GET_RELEVANT_TERMS (
DOCUMENT IN FULLTEXT INDEX WHERE FEDERAL_AWARD_ID_NUMBER = 1242501
SEARCH "AWARD_ABSTRACT" FROM SHA.TEXTMINING_AWARDS
RETURN
TOP 10 ) AS T;

SELECT T.TERM, T.NORMALIZED_TERM, T.TERM_TYPE, T.TERM_FREQUENCY,
T.DOCUMENT_FREQUENCY, T.SCORE
FROM TM_GET_SUGGESTED_TERMS (
TERM 'a'
SEARCH "AWARD_ABSTRACT" FROM SHA.TEXTMINING_AWARDS
RETURN
TOP 10 ) AS T;

SELECT UPPER(PROGRAM) AS PROGRAM , COUNT(*) AS COUNT 
FROM "SHA"."TEXTMINING_AWARDS"
GROUP BY PROGRAM
ORDER BY 2 DESC;

SELECT AWARD_TITLE, AWARD_ABSTRACT, PROGRAM
FROM SHA.TEXTMINING_AWARDS
WHERE FEDERAL_AWARD_ID_NUMBER = 1242501;

SELECT CATEGORY_COLUMN, RANK, CATEGORY_VALUE, NEIGHBOR_COUNT, SCORE
FROM TM_CATEGORIZE_KNN (
DOCUMENT IN FULLTEXT INDEX WHERE FEDERAL_AWARD_ID_NUMBER = 1242501
SEARCH NEAREST NEIGHBORS 20 "AWARD_ABSTRACT" FROM SHA.TEXTMINING_AWARDS
RETURN
TOP 10
PROGRAM FROM SHA.TEXTMINING_AWARDS
);
