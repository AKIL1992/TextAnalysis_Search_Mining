#############################################
# NEW TEXT MINING OPTIONS IN HANA 2.0 SPS00 #
#############################################

CREATE TABLE TEXTMINING_AWARDS
LIKE "TEXTMINING"."TEXTMINING_AWARDS"
WITH DATA

DROP TABLE TEXTMINING_AWARDS;
CREATE COLUMN TABLE TEXTMINING_AWARDS 
(
"FEDERAL_AWARD_ID_NUMBER" NVARCHAR(10), 
"PDPI_NAME" NVARCHAR(500), 
"AWARD_DATE" DAYDATE CS_DAYDATE, 
"AWARD_YEAR" NVARCHAR(4), 
"AWARD_AMOUNT" INTEGER CS_INT, 
"AWARD_TITLE" NVARCHAR(5000), 
"AWARD_ABSTRACT" NCLOB MEMORY THRESHOLD 1000, 
"PROGRAM" NVARCHAR(500), 
"CONST" NVARCHAR(5), 
"COU" INTEGER CS_INT, 
"AWARDEE" NVARCHAR(500), 
"AWARDEE_STREET" NVARCHAR(500), 
"AWARDEE_CITY" NVARCHAR(500), 
"AWARDEE_COUNTY" NVARCHAR(500), 
"AWARDEE_STATE" NVARCHAR(500), 
"AWARDEE_COUNTRY" NVARCHAR(500), 
"AWARDEE_NAME" NVARCHAR(500), 
PRIMARY KEY ("FEDERAL_AWARD_ID_NUMBER")
);

-- import data from csv
https://github.com/saphanaacademy/TextAnalysis_Search_Mining/blob/master/miningdata.csv.zip

SELECT UPPER(PROGRAM) AS PROGRAM , COUNT(*) AS COUNT 
FROM TEXTMINING_AWARDS
GROUP BY PROGRAM
ORDER BY 2 DESC;

SELECT AWARD_TITLE, AWARD_ABSTRACT, PROGRAM
FROM TEXTMINING_AWARDS
WHERE FEDERAL_AWARD_ID_NUMBER = 1348558;

DROP FULLTEXT INDEX TEXTMINING_INDEX;
CREATE FULLTEXT INDEX TEXTMINING_INDEX
ON TEXTMINING_AWARDS (AWARD_ABSTRACT)
FAST PREPROCESS OFF
SEARCH ONLY OFF
TEXT ANALYSIS ON
TEXT MINING ON;

MERGE DELTA OF TEXTMINING_AWARDS;

SELECT CATEGORY_COLUMN, RANK, CATEGORY_VALUE, NEIGHBOR_COUNT, SCORE
FROM TM_CATEGORIZE_KNN (
DOCUMENT IN FULLTEXT INDEX WHERE FEDERAL_AWARD_ID_NUMBER = 1348558
SEARCH NEAREST NEIGHBORS 20 "AWARD_ABSTRACT" FROM SYSTEM.TEXTMINING_AWARDS
RETURN
TOP 10
PROGRAM FROM SYSTEM.TEXTMINING_AWARDS
);

-- New DEFAULT Keyword for SQL functions

SELECT CATEGORY_COLUMN, RANK, CATEGORY_VALUE, NEIGHBOR_COUNT, SCORE
FROM TM_CATEGORIZE_KNN (
DOCUMENT IN FULLTEXT INDEX WHERE FEDERAL_AWARD_ID_NUMBER = 1348558
SEARCH NEAREST NEIGHBORS DEFAULT "AWARD_ABSTRACT" FROM SYSTEM.TEXTMINING_AWARDS
RETURN
TOP DEFAULT
PROGRAM FROM SYSTEM.TEXTMINING_AWARDS
);

<--
The NEAREST NEIGHBORS and TOP parameters in the SQL functions for text mining can specify the value as DEFAULT, instead of a numeric value. Using DEFAULT causes the function to use the same value that was used at text mining initialization (either the original value from the text mining configuration, or an override value specified using the TEXT MINING CONFIGURATION OVERLAY parameter or the initialize function in the text mining XS classic or advanced APIs).
-->

